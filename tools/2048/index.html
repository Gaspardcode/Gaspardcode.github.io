<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 5x5</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #faf8ef;
            margin: 0;
        }
        #score {
            font-size: 24px;
            margin-bottom: 20px;
        }
        #game-board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-template-rows: repeat(5, 100px);
            gap: 10px;
        }
        .tile {
            width: 100px;
            height: 100px;
            background-color: #cdc1b4;
            color: #776e65;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
        }
        .tile[data-value="2"]    { background-color: #eee4da; color: #776e65; }
        .tile[data-value="4"]    { background-color: #ede0c8; color: #776e65; }
        .tile[data-value="8"]    { background-color: #f2b179; color: #f9f6f2; }
        .tile[data-value="16"]   { background-color: #f59563; color: #f9f6f2; }
        .tile[data-value="32"]   { background-color: #f67c5f; color: #f9f6f2; }
        .tile[data-value="64"]   { background-color: #f65e3b; color: #f9f6f2; }
        .tile[data-value="128"]  { background-color: #edcf72; color: #f9f6f2; }
        .tile[data-value="256"]  { background-color: #edcc61; color: #f9f6f2; }
        .tile[data-value="512"]  { background-color: #edc850; color: #f9f6f2; }
        .tile[data-value="1024"] { background-color: #edc53f; color: #f9f6f2; }
        .tile[data-value="2048"] { background-color: #edc22e; color: #f9f6f2; }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="game-board"></div>
    
    <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCFu-Dh9zwypzRBa9JBipmrJSDmGBoPfxs",
        authDomain: "website-8c2a3.firebaseapp.com",
        projectId: "website-8c2a3",
        storageBucket: "website-8c2a3.appspot.com",
        messagingSenderId: "648151795084",
        appId: "1:648151795084:web:bfa39fa89ba558deb8c2a9",
        measurementId: "G-VN0F5R528E"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    </script>

    <script>
        const gridSize = 5;
        let board = [];
        let score = 0;

        function initBoard() {
            board = Array(gridSize).fill().map(() => Array(gridSize).fill(0));
            score = 0;
            updateScore();
            addRandomTile();
            addRandomTile();
            updateBoard();
        }

        function updateScore() {
            document.getElementById('score').textContent = `Score: ${score}`;
        }

        function addRandomTile() {
            let emptyTiles = [];
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (board[i][j] === 0) {
                        emptyTiles.push({ x: i, y: j });
                    }
                }
            }

            if (emptyTiles.length > 0) {
                let { x, y } = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                board[x][y] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function updateBoard() {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    let tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.textContent = board[i][j] !== 0 ? board[i][j] : '';
                    if (board[i][j] !== 0) {
                        tile.setAttribute('data-value', board[i][j]);
                    }
                    gameBoard.appendChild(tile);
                }
            }
        }

        function moveTiles(direction) {
            let moved = false;

            function slide(row) {
                let arr = row.filter(val => val);
                let missing = gridSize - arr.length;
                let zeros = Array(missing).fill(0);
                moved = true;
                return arr.concat(zeros);
            }

            function combine(row) {
                for (let i = 0; i < gridSize - 1; i++) {
                    if (row[i] !== 0 && row[i] === row[i + 1]) {
                        row[i] *= 2;
                        row[i + 1] = 0;
                        score += row[i];  // Ajouter la valeur de la tuile fusionnée au score
                        updateScore();  // Mettre à jour l'affichage du score
                        moved = true;
                    }
                }
                return row;
            }

            function operate(row) {
                row = slide(row);
                row = combine(row);
                row = slide(row);
                return row;
            }

            for (let i = 0; i < gridSize; i++) {
                let row;
                if (direction === 'left' || direction === 'right') {
                    row = board[i].slice();
                    if (direction === 'right') row.reverse();
                    row = operate(row);
                    if (direction === 'right') row.reverse();
                    board[i] = row;
                } else if (direction === 'up' || direction === 'down') {
                    row = board.map(row => row[i]);
                    if (direction === 'down') row.reverse();
                    row = operate(row);
                    if (direction === 'down') row.reverse();
                    for (let j = 0; j < gridSize; j++) {
                        board[j][i] = row[j];
                    }
                }
            }

            if (moved) {
                addRandomTile();
            }
        }

        function checkGameOver() {
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (board[i][j] === 0) {
                        return false;
                    }
                    if (i < gridSize - 1 && board[i][j] === board[i + 1][j]) {
                        return false;
                    }
                    if (j < gridSize - 1 && board[i][j] === board[i][j + 1]) {
                        return false;
                    }
                }
            }
            alert('Game Over!');
            return true;
        }

        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'ArrowUp':
                    moveTiles('up');
                    break;
                case 'ArrowDown':
                    moveTiles('down');
                    break;
                case 'ArrowLeft':
                    moveTiles('left');
                    break;
                case 'ArrowRight':
                    moveTiles('right');
                    break;
            }
            updateBoard();
            if (checkGameOver()) {
                initBoard();
            }
        });

        initBoard();
    </script>
</body>
</html>
